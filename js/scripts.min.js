!function(e){e.fn.jqPuzzle=function(r,i){var a={rows:4,cols:4,hole:16,shuffle:!1,numbers:!0,language:"en",control:{shufflePieces:!0,confirmShuffle:!0,toggleOriginal:!0,toggleNumbers:!0,counter:!0,timer:!0,pauseTimer:!1},success:{fadeOriginal:!0,callback:void 0,callbackTimeout:300},animation:{shuffleRounds:3,shuffleSpeed:800,slidingSpeed:200,fadeOriginalSpeed:600},style:{gridSize:2,overlap:!0,backgroundOpacity:.1}},t={en:{shuffleLabel:"Shuffle",toggleOriginalLabel:"Original",toggleNumbersLabel:"Numbers",confirmShuffleMessage:"Do you really want to shuffle?",movesLabel:"moves",secondsLabel:"seconds"},fr:{shuffleLabel:"MÃ©langer",toggleOriginalLabel:"Original",toggleNumbersLabel:"Nombres",confirmShuffleMessage:"Veux-tu vraiment mÃ©langer?",movesLabel:"mouvements",secondsLabel:"secondes"},de:{shuffleLabel:"Mischen",toggleOriginalLabel:"Original",toggleNumbersLabel:"Nummern",confirmShuffleMessage:"Willst du wirklich mischen?",movesLabel:"ZÃ¼ge",secondsLabel:"Sekunden"},pt:{shuffleLabel:"Embaralhar",toggleOriginalLabel:"Original",toggleNumbersLabel:"Numeros",confirmShuffleMessage:"Tem certeza que deseja reembralhar?",movesLabel:"movimentos",secondsLabel:"segundos"}};r&&!r.hole&&(r.rows||r.cols)&&(r.hole=(r.rows||a.rows)*(r.cols||a.cols)),r=e.extend(!0,{},a,r),i=e.extend(t[r.language]||t[a.language],i);var o=r.rows,n=r.cols,s=r.hole,l=r.control,d=r.success,p=r.animation,u=r.style;(o<3||o>9)&&(o=a.rows),(n<3||n>9)&&(n=a.rows),(s>o*n||s<1)&&(s=o*n),s--,p.slidingSpeed<1&&(p.slidingSpeed=1),p.shuffleSpeed<1&&(p.shuffleSpeed=1),p.fadeOriginalSpeed<1&&(p.fadeOriginalSpeed=1),p.shuffleRounds<1&&(p.shuffleRounds=1);var c=function(e){for(var r=0;r<e.length;r++){var i=r<s?r:r+1;if(e.eq(r).attr("current")!=i)return!1}return!0},f=function(e){for(var r=1,i=1;i<=o*n-1;i++)for(var a=i+1;a<=o*n;a++)r*=(e[i-1]-e[a-1])/(i-a);return 1==Math.round(r)},g=function(e,r){return parseInt(e)*n+parseInt(r)},h=function(e){return{row:Math.floor(e/n),col:e%n}},b=function(e){var r=e.css("border-left-width");if("none"!=e.css("border-left-style"))switch(r){case"thin":return 2;case"medium":return 4;case"thick":return 6;default:return parseInt(r)||0}return 0},m=function(e,r){var i,a,t,o=0,n=function(){s((new Date).getTime()),t=setTimeout(n,e)},s=function(e){r(e-o-i)};this.start=function(){if(i)return!1;i=(new Date).getTime(),n()},this.stop=function(){if(!i)return!1;clearTimeout(t);var e=(new Date).getTime();a&&(o+=e-a),s(e),i=a=void 0,o=0},this.pause=function(){if(!i||a)return!1;clearTimeout(t),a=(new Date).getTime()},this.resume=function(){if(!a)return!1;o+=(new Date).getTime()-a,a=void 0,n()}};return this.filter("img").each(function(){var a,t,v=e(this),w=!1,q=0,j=0,O=r.shuffle,S=s,T=e("<div/>").addClass("jqp-piece"),C=e("<div/>").addClass("jqp-wrapper").append(T),k=e("<div/>").attr("class",v.attr("class")||"").addClass("jqPuzzle").append(C);v.replaceWith(k),k.attr("id",v.attr("id")||"");var x={gui:{border:b(k),padding:{left:parseInt(k.css("padding-left"))||0,right:parseInt(k.css("padding-right"))||0,top:parseInt(k.css("padding-top"))||0,bottom:parseInt(k.css("padding-bottom"))||0}},wrapper:{border:b(C),padding:parseInt(C.css("padding-left"))||0},piece:{border:b(T)}};k.removeAttr("id"),k.replaceWith(v),v.one("load",function(){var b=0===u.gridSize&&u.overlap,T=n*(2*x.piece.border)+(n-1)*u.gridSize,C=o*(2*x.piece.border)+(o-1)*u.gridSize;b&&(T-=(n-1)*x.piece.border,C-=(o-1)*x.piece.border),v.css({width:"auto",height:"auto",visibility:"visible"});var k=Math.floor((v.width()-T)/n),L=Math.floor((v.height()-C)/o);if(k<30||L<30)return!1;for(var y=n*k+T,M=o*L+C,z=v.attr("src"),N=k+2*x.piece.border+u.gridSize,I=L+2*x.piece.border+u.gridSize,P={piece:e.boxModel?0:2*x.piece.border,wrapper:e.boxModel?0:2*(x.wrapper.border+x.wrapper.padding),gui:{width:e.boxModel?0:2*x.gui.border+x.gui.padding.left+x.gui.padding.right,height:e.boxModel?0:2*x.gui.border+x.gui.padding.top+x.gui.padding.bottom}},D=function(e,r){var i={left:x.wrapper.padding+r*N,top:x.wrapper.padding+e*I};return b&&(i.left-=r*x.piece.border,i.top-=e*x.piece.border),i},W=function(e,r){if(r){if(H.is(".jqp-disabled"))return!1;if(w)return!1;if(l.confirmShuffle&&q>0&&!window.confirm(i.confirmShuffleMessage))return!1;w=!0,a&&(te.removeClass("jqp-solved"),U.fadeTo(p.fadeOriginalSpeed,u.backgroundOpacity,function(){U.remove().prependTo(R),re.removeClass("jqp-disabled")}))}t&&t.stop(),a=!1,O=!0,q=0,j=0,$&&$.removeClass("jqp-disabled"),_&&_.val(q),ee&&ee.val(j);for(var d=[],c=0;c<e;){for(var g=[],b=0;b<o*n;b++)g[b]=b;g.splice(s,1),d[c]=[];for(b=0;b<o*n;b++)if(b!=s){var m=Math.floor(Math.random()*g.length);d[c][b]=g[m],g.splice(m,1)}else d[c][b]=s;(c+1<e||f(d[c]))&&c++}for(var v=0,c=0;c<e;c++)for(var T=c+1==e,b=0;b<d[c].length;b++)if(b!=s){var C=d[c][b];C>s&&(C-=1);var k=E.eq(C),x=h(b),L=D(x.row,x.col);T&&k.attr("current",b.toString()),void 0===r?k.css({left:L.left,top:L.top}):k.animate({left:L.left,top:L.top},r,null,function(){++v==p.shuffleRounds*(o*n-1)&&(w=!1,v=0)})}else T&&(S=s)},R=e("<div/>").addClass("jqp-wrapper").css({width:y+P.wrapper,height:M+P.wrapper,borderWidth:x.wrapper.border,padding:x.wrapper.padding,margin:0,position:"relative",overflow:"hidden",display:"block",visibility:"inherit"}),A=e("<div/>").addClass("jqp-piece").css({width:k+P.piece,height:L+P.piece,backgroundImage:"url("+z+")",borderWidth:x.piece.border,margin:0,padding:0,position:"absolute",overflow:"hidden",display:"block",visibility:"inherit",cursor:"default"}).append(e("<span/>")),E=e([]),B=0;B<o;B++)for(var Z=0;Z<n;Z++){var F=g(B,Z);if(F!=s){var Q=D(B,Z),V=-1*(Z*N+x.piece.border),G=-1*(B*I+x.piece.border);b&&(V+=Z*x.piece.border,G+=B*x.piece.border),E=E.add(A.clone().css({left:Q.left,top:Q.top,backgroundPosition:V+"px "+G+"px"}).attr("current",String(F)).appendTo(R).children().text(F+1).end())}}r.shuffle&&W(1);var H,J,K,U=e("<div/>").css({width:y,height:M,left:x.wrapper.padding,top:x.wrapper.padding,backgroundImage:"url("+z+")",borderWidth:0,margin:0,padding:0,position:"absolute",opacity:u.backgroundOpacity}).prependTo(R),X=e("<div/>").addClass("jqp-controls").css({visibility:"inherit",display:"block",position:"static"}),Y=e("<a/>").css("cursor","default");l.shufflePieces&&(H=Y.clone().text(i.shuffleLabel).appendTo(X)),l.toggleOriginal&&(J=Y.clone().text(i.toggleOriginalLabel).appendTo(X)),l.toggleNumbers&&(K=Y.clone().text(i.toggleNumbersLabel).appendTo(X),r.numbers&&K.addClass("jqp-toggle"));var $,_,ee,re=X.children();if(l.counter||l.timer){$=e("<span/>").css("cursor","default").appendTo(X);var ie=e("<input/>").val(0).css({width:"5ex",cursor:"default"}).attr("readonly","readonly");l.counter&&(_=ie.clone().appendTo($).after(i.movesLabel+" ")),l.timer&&(ee=ie.clone().appendTo($).after(i.secondsLabel)),r.shuffle||$.addClass("jqp-disabled")}var ae=e("<div/>").css({width:y+2*(x.wrapper.padding+x.wrapper.border),position:"absolute",display:"block",visibility:"inherit",margin:"0px",padding:"0px",backgroundColor:"transparent"}).append(X),te=e("<div/>").attr("class",v.attr("class")||"").addClass("jqPuzzle").css({width:y+2*(x.wrapper.padding+x.wrapper.border)+P.gui.width,height:M+2*(x.wrapper.padding+x.wrapper.border)+P.gui.height,textAlign:"left",overflow:"hidden",display:"block"}).append(R).append(ae);v.replaceWith(te);var oe=v.attr("id");oe&&te.attr("id",oe),r.numbers||E.children().hide(),$&&$.children("input").val(0);te.height(),ae.height();te.height(te.height()+ae.height()),e.browser.msie?te[0].onselectstart=function(){return!1}:te.mousedown(function(){return!1}),re.mousedown(function(){e(this).is(".jqp-disabled")||e(this).addClass("jqp-down")}),re.mouseout(function(){e(this).removeClass("jqp-down")}),re.mouseup(function(){e(this).removeClass("jqp-down")}),E.click(function(){if(w)return!1;if(a)return!1;w=!0;var r=e(this),i=r.attr("current"),o=h(i),n=h(S);if(Math.abs(o.row-n.row)+Math.abs(o.col-n.col)!=1)return w=!1,!1;var s=D(n.row,n.col);r.attr("current",String(S)),S=i,O&&q++,_&&_.val(q),1==q&&(t||(t=new m(333,function(e){j=Math.floor(e/1e3),ee&&ee.val(j)})),t.start()),r.animate({left:s.left,top:s.top},p.slidingSpeed,null,function(){O&&(a=c(E))?(t&&t.stop(),O=!1,te.addClass("jqp-solved"),window.setTimeout(ne,100)):w=!1})}),l.shufflePieces&&H.click(function(){W(p.shuffleRounds,p.shuffleSpeed)}),l.toggleOriginal&&J.click(function(){return!J.is(".jqp-disabled")&&(!w&&(w=!0,J.is(".jqp-toggle")?(l.shufflePieces&&H.removeClass("jqp-disabled"),l.toggleNumbers&&K.removeClass("jqp-disabled"),J.removeClass("jqp-toggle"),U.fadeTo(p.fadeOriginalSpeed,u.backgroundOpacity,function(){e(this).prependTo(R),l.pauseTimer&&t&&t.resume(),w=!1})):(l.shufflePieces&&H.addClass("jqp-disabled"),l.toggleNumbers&&K.addClass("jqp-disabled"),J.addClass("jqp-toggle"),l.pauseTimer&&t&&t.pause(),U.appendTo(R).fadeTo(p.fadeOriginalSpeed,1,function(){w=!1})),!1))}),l.toggleNumbers&&K.click(function(){if(K.is(".jqp-disabled"))return!1;K.is(".jqp-toggle")?(K.removeClass("jqp-toggle"),E.children().hide()):(K.addClass("jqp-toggle"),E.children().show())});var ne=function(){d.fadeOriginal?(l.toggleOriginal&&J.addClass("jqp-disabled"),l.toggleNumbers&&K.addClass("jqp-disabled"),U.appendTo(R).fadeTo(p.fadeOriginalSpeed,1,function(){w=!1,se()})):(w=!1,se())},se=function(){e.isFunction(d.callback)&&setTimeout(function(){d.callback({moves:q,seconds:j})},d.callbackTimeout)}});var L=setInterval(function(){v[0].complete&&(clearInterval(L),v.trigger("load"))},333)}).end()},e(document).ready(function(){e("img.jqPuzzle").each(function(){var r,i=/\bjqp(-[a-z]{2})?-r(\d)-c(\d)(-h(\d+))?(-s(\d+))?(-[A-Z]+)?\b/.exec(this.className);i&&(r={rows:parseInt(i[2]),cols:parseInt(i[3]),hole:parseInt(i[5])||null,shuffle:i[8]&&-1!=i[8].indexOf("S"),numbers:!i[8]||-1==i[8].indexOf("N"),language:i[1]&&i[1].substring(1)},i[7]&&(r.animation={},r.animation.shuffleRounds=parseInt(i[7])),i[8]&&-1!=i[8].search(/[ABCDE]/)&&(r.control={},r.control.shufflePieces=-1==i[8].indexOf("A"),r.control.toggleOriginal=-1==i[8].indexOf("B"),r.control.toggleNumbers=-1==i[8].indexOf("C"),r.control.counter=-1==i[8].indexOf("D"),r.control.timer=-1==i[8].indexOf("E"))),e(this).jqPuzzle(r)})})}(jQuery);